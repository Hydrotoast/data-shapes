<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-US">
  <head>
    <title>SHACL Semantics</title>
    <meta charset='utf-8'></meta>
    <script src='//www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <link rel="stylesheet" type="text/css" href="local.css" />
    <script class='remove'>
      var respecConfig = {
          specStatus: "ED",
          edDraftURI:  "http://w3c.github.io/data-shapes/semantics/#dfn-shacl-shape",
          shortName:  "shacl-semantics",
          editors: [
                {   name:       "Eric Prud'hommeaux",
                    url:        "http://www.w3.org/People/Eric/",
                    company:    "W3C/MIT",
                    companyURL: "http://www.w3.org/" }
          ],
          wg:           "RDF Data Shapes Working Group",
          wgURI:        "https://www.w3.org/2014/data-shapes",
          wgPublicList: "public-rdf-shapes",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/73865/status",
		  localBiblio:  {
			"xyz": {
				title:    "Sample Custom Reference",
				href:     "http://example.org/",
				"authors": [
					"S. Steyskal"
				],
				publisher: "xyz"
		    }
		  }
      };
    </script>
		<style>
			.todo {
				color: red;
			}
		    pre {
				tab-size: 4;
		    }
			th {
				text-align: left;
			}
      .comment {
        /* font-lock-comment-face */
        color: #b22222;
      }
      .constant {
        /* font-lock-constant-face */
        color: #008b8b;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #0000ff;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #a020f0;
      }
      .string {
        /* font-lock-string-face */
        color: #8b2252;
      }
      .type {
        /* font-lock-type-face */
        color: #228b22;
      }
      .example {
        display: inline-block;
      }
      .example.wrapper {
        background-color: #fff;
      }
      .example.wrapper pre {
        background-color: #fcfaee;
        margin-left: 0;
        line-height: 1.2;
      }
      .example.wrapper .fail {
        background-color: #fceefa
      }
      .verticalDivider {
        float: left;
        width: .5em;
        border:thin solid #fff; /* disappears without this */
      }

.highlight1     { margin-left: -5px; margin-right: -5px;   border-left: 5px solid rgba(176, 176, 0, .5); border-right: 5px solid rgba(176, 176, 0, .5); } /* font-weight: bold  ;  */
.highlight1.top {    margin-top: -5px;                      border-top: 5px solid rgba(176, 176, 0, .5);                                                } /* font-weight: bold  ;  */
.highlight1.bot { margin-bottom: -5px;                   border-bottom: 5px solid rgba(176, 176, 0, .5);                                                } /* font-weight: bold  ;  */
.lowlight1      { margin-left: -5px; margin-right: -5px;   border-left: 5px solid transparent; border-right: 5px solid transparent;                     } /* font-weight: normal;  */
.lowlight1.top  {    margin-top: -5px;                      border-top: 5px solid transparent;                                                          } /* font-weight: normal;  */
.lowlight1.bot  { margin-bottom: -5px;                   border-bottom: 5px solid transparent;                                                          } /* font-weight: normal;  */
.highlight2     { margin-left: -5px; margin-right: -5px;   border-left: 5px solid rgba(176, 0, 176, .5); border-right: 5px solid rgba(176, 0, 176, .5); } /* font-weight: bold  ;  */
.highlight2.top {    margin-top: -5px;                      border-top: 5px solid rgba(176, 0, 176, .5);                                                } /* font-weight: bold  ;  */
.highlight2.bot { margin-bottom: -5px;                   border-bottom: 5px solid rgba(176, 0, 176, .5);                                                } /* font-weight: bold  ;  */
.lowlight2      { margin-left: -5px; margin-right: -5px;   border-left: 5px solid rgba(127, 127, 127, .07); border-right: 5px solid rgba(127, 127, 127, .07);         } /* font-weight: normal;  */
.lowlight2.top  {    margin-top: -5px;                      border-top: 5px solid rgba(127, 127, 127, .07);                                                           } /* font-weight: normal;  */
.lowlight2.bot  { margin-bottom: -5px;                   border-bottom: 5px solid rgba(127, 127, 127, .07);                                                           } /* font-weight: normal;  */

.highlightBG1   { /* border: 5px solid transparent; */ background-color: #bb0; font-weight: bold; }
.lowlightBG1    { /* border: 5px solid transparent; */ font-weight: normal; }
.highlightBG2   { /* border: 5px solid transparent; */ background-color: #b00; font-weight: bold; }
.lowlightBG2    { /* border: 5px solid transparent; */ font-weight: normal; }

.new            { font-weight: bold; }
.errorSite      { color: red; }

.defn {
margin-left: 0;
margin-right: 2ex;
margin-top: 0.1ex;
margin-bottom: 0.1ex;
/* border: double 1px #888888; */
border: thin solid #888888;
padding: 1ex 2ex 0.5ex 2ex;
page-break-inside: avoid;
background-color: #F0F8F8;
}
h3 sup,h4 sup,.eval {
  font-weight: lighter;
  color: #307;
}
		</style>
  </head>
  <body>
    <section id='abstract'>
      This document defines the interpretation of SHACL with respect to matching graphs of instance data.
    </section>

    <section id='sotd'>

      <p>
        Proposal to RDF Data Shapes WG
      </p>
    </section>

    <!-- taken from http://www.w3.org/2014/data-shapes/charter -->
    <section id="intro" class='informative'>
      <h2>Introduction</h2>
			<p>
				SHACL (Shapes Constraint Language) provides structural constraints for <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graphs</a>.
				SHACL constraints are grouped into conjunctions called "shapes", which may also be referenced by constraints in other shapes.
				These constraints restrict the predicates of <a href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triples</a> connecting nodes in the graph.
				SHACL can restrict the number of these triples and the permitted object datatype or object terms, require that the subject or object match some shape or lexical and datatype conditions.
			</p>

    </section>

    <section id="notation">
      <h2>Notation</h2>
      <p>
        The following HTML tags and CSS classes are used to highlight the roles of text in this document:
      </p>
      <ul>
        <li>&lt;dfn&gt;<dfn id="dfn-shacl-defined-term">defined term</dfn>&lt;dfn&gt;</li>
        <li>&lt;a class="internalDFN"&gt;<a title="SHACL defined term" href="#dfn-shacl-defined-term" class="internalDFN">defined term</a>&lt;/a&gt;</li>
        <li><sup class="eval">eval</sup> &mdash; link to evaluation semantics</li>
      </ul>
    </section>

    <section>
      <h2>Abstract Syntax</h2>
			<p>
				A <dfn id="dfn-shacl-shape">shape</dfn> <sup><a title="shape matches" href="#dfn-shacl-shape-matches">eval</a></sup> describes the triples whose subject or object is some <dfn id="dfn-shacl-focus-node">focus node</dfn> in an RDF graph.
				A shape has zero or one <dfn id="dfn-shacl-triple-constraint">triple constraints</dfn> attached to it which describe the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a>'s triples.
        A triple constraint is one of the following:
      </p>
      <ul>
        <li><a title="property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint</a> defines the characteristics of matching triples associated with the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a>.</li>
        <li><a title="inverse property constraint" href="#dfn-shacl-inverse-property-constraint" class="internalDFN">inverse property constraint</a> defines the characteristics of matching triples associated with the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a>.</li>
        <li><a title="and constraint" href="#dfn-shacl-and-constraint" class="internalDFN">and constraint</a> defines matching of a set of <a title="constraint" href="#dfn-shacl-triple-constraint" class="internalDFN">triple constraints</a>.</li>
        <li><a title="or constraint" href="#dfn-shacl-or-constraint" class="internalDFN">or constraint</a> defines matching of a set of <a title="constraint" href="#dfn-shacl-triple-constraint" class="internalDFN">triple constraints</a>.</li>
      </ul>
      <p>
			</p>
      <section>
        <h3>Property Constraint <sup><a title="SHACL property constraint matches" href="#dfn-shacl-property-constraint-matches" class="internalDFN">eval</a></sup></h3>
			  <p>
				  A <dfn id="dfn-shacl-property-constraint">property constraint</dfn> has a <dfn id="dfn-shacl-predicate">predicate</dfn> which identifies the triple's predicate and may have a <dfn id="dfn-shacl-min-card">minimum cardinality</dfn> and/or <dfn id="dfn-shacl-max-card">maximum cardinality</dfn>, to indicate how many triples with that predicate are expected.
				  The property constraint also has zero or one <a title="SHACL term constraint" href="#dfn-shacl-term-constraint" class="internalDFN">term constraints</a> which apply to the <em>object</em> of <a title="SHACL conjunct" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a>.
			  </p>
        <section id="dfn-shacl-term-constraint">
          <h4>Term Constraints</h4>
          <p>
            Where a triple constraint describes matching <a title="RDF Triples" href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" class="externalDFN">RDF Triples</a> [[!RDF11-CONCEPTS]], a term constraint describes matching <a title="RDF Term" href="http://www.w3.org/TR/rdf11-concepts/#dfn-rdf-term" class="externalDFN">RDF Terms</a> [RDF Concepts].
          </p>
			  <ul>
				  <li><dfn id="dfn-shacl-node-type">node type</dfn> <sup><a title="SHACL node type matches" href="#dfn-node-type-matches" class="internalDFN">eval</a></sup>: identifies the RDF Node type (<a title="RDF IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-iri" class="externalDFN">IRI</a>, <a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">RDF literal</a>, or <a title="RDF Blank Node" href="http://www.w3.org/TR/rdf11-concepts/#dfn-blank-node" class="externalDFN">Blank Node</a>).</li>
				  <li><dfn id="dfn-shacl-datatype">datatype</dfn> <sup><a title="SHACL datatype matches" href="#dfn-datatype-matches" class="internalDFN">eval</a></sup>: identifies the <a title="datatype IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" class="externalDFN">datatype IRI</a> of an <a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">RDF literal</a>.</li>
				  <li><dfn id="dfn-shacl-value-set">value set</dfn> <sup><a title="SHACL value set matches" href="#dfn-shacl-value-set-matches" class="internalDFN">eval</a></sup>: a set of permissible <a title="RDF IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-iri" class="externalDFN">IRI</a>, <a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">RDF literal</a> values called <dfn id="dfn-shacl-allowed-value">allowed values</dfn>.</li>
				  <li><dfn id="dfn-shacl-value-shape">value shape</dfn> <sup><a title="SHACL valu shape matches" href="#dfn-shacl-value-shape-matches" class="internalDFN">eval</a></sup>: identifies a <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a> and asserts that the term is described by that shape.</li>
			  </ul>
        </section>
      </section>

      <section>
        <h3>Inverse Property Constraint <sup><a title="SHACL inverse property constraint matches" href="#dfn-shacl-inverse-property-constraint-matches" class="internalDFN">eval</a></sup></h3>
			  <p>
          The <dfn id="dfn-shacl-inverse-property-constraint">inverse property constraint</dfn> is comprised of the same components as the property constraint except it may NOT have:
			  </p>
        <ul>
          <li>a <a title="SHACL conjunct" href="#dfn-shacl-datatype" class="internalDFN">datatype</a> constraint</li>
          <li>a <a title="value set" href="#dfn-shacl-value-set" class="internalDFN">value set</a> with any <a title="SHACL conjunct" href="#dfn-shacl-allowed-value" class="internalDFN">allowed value</a> which is an RDF Literal</li>
        </ul>
        <p>
				  <a title="SHACL term constraint" href="#dfn-shacl-term-constraint" class="internalDFN">Term constraints</a> apply to the <em>subject</em> of <a title="SHACL conjunct" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a>.
        </p>
      </section>

      <section>
        <h3>And Constraint <sup><a title="SHACL and constraint matches" href="#dfn-shacl-and-constraint-matches" class="internalDFN">eval</a></sup></h3>
			  <p>
          The <dfn id="dfn-shacl-and-constraint">and constraint</dfn> is a set of properties called <dfn id="dfn-shacl-conjunct">conjuncts</dfn>.
			  </p>
      </section>

      <section>
        <h3>Or Constraint <sup><a title="SHACL or constraint matches" href="#dfn-shacl-or-constraint-matches" class="internalDFN">eval</a></sup></h3>
			  <p>
          The <dfn id="dfn-shacl-or-constraint">or constraint</dfn> is a set of properties called <dfn id="dfn-shacl-conjunct">disjuncts</dfn>.
			  </p>
      </section>
    </section>

    <section>
      <h2>RDF Vocabulary</h2>
			<p>
        The SHACL abstract syntax above can be represented in an RDF graph.
        RDF graphs are subject to the constraints in the abstract syntax above, e.g. that a property constraint may have at most one term constraint.
        Triples in "[]"s are optional type arcs.
      </p>
      <div class="center">
        <table class="allname" style="text-align: left" border="2" cellpadding="5">
          <caption> <span class="caption">Table 1.</span> Transformation to Triples
          </caption>
          <tbody>
            <tr><th>SHACL construct</th>                                                                                                                                <th>RDF triple</th><th>notes</th></tr>
            <tr><td><a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a></td>                                                                   <td class="name">[&lt;<b>SH</b>&gt; a <span class="type">sh:</span><span class="constant">Shape</span> .]<br/>&lt;<b>SH</b>&gt; <span class="type">sh:</span><span class="constant">property</span> &lt;PC&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint</a></td>                         <td class="name">&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">property</span> &lt;<b>PC</b>&gt; .<br/>[&lt;<b>PC</b>&gt; a <span class="type">sh:</span><span class="constant">PropertyConstraint</span> .]</td><td></td></tr>
            <tr><td><a title="SHACL inverse property constraint" href="#dfn-shacl-inverse-property-constraint" class="internalDFN">inverse property constraint</a></td> <td class="name">&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">inverseProperty</span> &lt;<b>IPC</b>&gt; .<br/>[&lt;<b>IPC</b>&gt; a <span class="type">sh:</span><span class="constant">PropertyConstraint</span> .]</td><td></td></tr>
            <tr><td><a title="SHACL and constraint" href="#dfn-shacl-and-constraint" class="internalDFN">and constraint</a></td>                                        <td class="name">&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">property</span> &lt;<b>TC1</b>&gt; .<br/>&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">property</span> &lt;<b>TC2</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL or constraint" href="#dfn-shacl-or-constraint" class="internalDFN">or constraint</a></td>                                           <td class="name">&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">choice</span> &lt;<b>TC1</b>&gt; .<br/>&lt;SH|TC&gt; <span class="type">sh:</span><span class="constant">choice</span> &lt;<b>TC2</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL predicate" href="#dfn-shacl-predicate" class="internalDFN">predicate</a></td>                                                       <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">predicate</span> &lt;<b>P</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL minimum cardinality" href="#dfn-shacl-min-card" class="internalDFN">minimum cardinality</a></td>                                    <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">minCard</span> <b><span class="type">xsd:</span><span class="constant">integer</span></b> .</td><td></td></tr>
            <tr><td><a title="SHACL maximum cardinality" href="#dfn-shacl-max-card" class="internalDFN">maximum cardinality</a></td>                                    <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">maxCard</span> <b><span class="type">xsd:</span><span class="constant">integer</span></b> .</td><td></td></tr>
            <tr><td><a title="SHACL node type" href="#dfn-shacl-node-type" class="internalDFN">node type</a></td>                                                       <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">nodeType</span> &lt;<b>NT</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL datatype" href="#dfn-shacl-datatype" class="internalDFN">datatype</a></td>                                                    <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">valueType</span> &lt;<b>VT</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL allowed value" href="#dfn-shacl-allowed value" class="internalDFN">allowed value</a></td>                                           <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">allowedValue</span> &lt;<b>VS</b>&gt; .</td><td></td></tr>
            <tr><td><a title="SHACL value shape" href="#dfn-shacl-value shape" class="internalDFN">value shape</a></td>                                                 <td class="name">&lt;PC&gt; <span class="type">sh:</span><span class="constant">valueShape</span> &lt;<b>VS</b>&gt; .</td><td></td></tr>
          </tbody>
        </table>
      </div>

      <div class="todo">
        <p>
          The above table doens't really explain that e.g. a conjuction
        </p>
    		<pre class="schema turtle"><span class="function-name">my:UserShape</span> <span class="keyword">a</span> <span class="type">sh:</span><span class="constant">Shape</span> ;
    <span class="type">sh:</span><span class="constant">property</span> [ <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">foaf:</span><span class="constant">name</span> ; <span class="type">sh:</span><span class="constant">valueType</span> <span class="type">xsd:</span><span class="constant">string</span> ] ;
    <span class="type">sh:</span><span class="constant">property</span> [ <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">foaf:</span><span class="constant">givenName</span> ; <span class="type">sh:</span><span class="constant">valueType</span> <span class="type">xsd:</span><span class="constant">string</span> ] .</pre>
        <p>
          produces an abstract syntax with a <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a> that has a <a title="SHACL and constraint" href="#dfn-shacl-and-constraint" class="internalDFN">and constraint</a> with two <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraints</a>.
          Do we need something as rigorous as <a href="http://www.w3.org/TR/2012/REC-owl2-mapping-to-rdf-20121211/#Parsing_of_Axioms">OWL's parsing axioms</a>?
        </p>
      </div>

      <p>
        RDF node types are identified by the following IRIs:
      </p>
      <div class="center">
        <table class="allname" style="text-align: left" border="2" cellpadding="5">
          <caption> <span class="caption">Table 2.</span> RDF Node Type Identifiers
          </caption>
          <tbody>
            <tr><th>RDF node type</th>                                                                                                                                <th>SHACL identifier</th></tr>
            <tr><td><a title="RDF IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-iri" class="externalDFN">IRI</a></td> <td class="name"><span class="type">sh:</span><span class="constant">IRI</span></td></tr>
            <tr><td><a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">Literal</a></td> <td class="name"><span class="type">sh:</span><span class="constant">Literal</span></td></tr>
            <tr><td><a title="RDF Blank Node" href="http://www.w3.org/TR/rdf11-concepts/#dfn-blank-node" class="externalDFN">Blank Node</a></td> <td class="name"><span class="type">sh:</span><span class="constant">BNode</span></td></tr>
          </tbody>
        </table>
      </div>

      <section>
        <h3>RDF instance example</h3>
        <p>
          The following example represents a shape <code><span class="function-name">my:UserShape</span></code> composed of an <a title="SHACL and constraint" href="#dfn-shacl-and-constraint" class="internalDFN">and constraint</a> with two <a title="SHACL conjunct" href="#dfn-shacl-conjunct" class="internalDFN">conjuncts</a>:
        </p>
        <ol>
          <li>An <a title="SHACL or constraint" href="#dfn-shacl-or-constraint" class="internalDFN">or constraint</a> with two <a title="SHACL disjunct" href="#dfn-shacl-disjunct" class="internalDFN">disjuncts</a>:
          <ol>
            <li>A <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint</a> with a <a title="SHACL predicate" href="#dfn-shacl-predicate" class="internalDFN">predicate</a> of <span class="type">foaf:</span><span class="constant">name</span>, a <a title="SHACL datatype" href="#dfn-shacl-datatype" class="internalDFN">datatype</a> of <span class="type">xsd:</span><span class="constant">string</span>, a <a title="SHACL minimum cardinality" href="#dfn-shacl-min-card" class="internalDFN">minimum cardinality</a> of 1, a <a title="SHACL maximum cardinality" href="#dfn-shacl-max-card" class="internalDFN">maximum cardinality</a> of 1.</li>
            <li>A <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint</a> with a <a title="SHACL predicate" href="#dfn-shacl-predicate" class="internalDFN">predicate</a> of <span class="type">foaf:</span><span class="constant">givenName</span>, a <a title="SHACL datatype" href="#dfn-shacl-datatype" class="internalDFN">datatype</a> of <span class="type">xsd:</span><span class="constant">string</span>, a <a title="SHACL minimum cardinality" href="#dfn-shacl-min-card" class="internalDFN">minimum cardinality</a> of 1, no <a title="SHACL maximum cardinality" href="#dfn-shacl-max-card" class="internalDFN">maximum cardinality</a>.</li>
          </ol>
          </li>
          <li>A <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint</a> with a <a title="SHACL predicate" href="#dfn-shacl-predicate" class="internalDFN">predicate</a> of <span class="type">foaf:</span><span class="constant">mbox</span>, a <a title="SHACL node type" href="#dfn-shacl-node type" class="internalDFN">node type</a> of RDF IRI, a <a title="SHACL minimum cardinality" href="#dfn-shacl-min-card" class="internalDFN">minimum cardinality</a> of 1, no <a title="SHACL maximum cardinality" href="#dfn-shacl-max-card" class="internalDFN">maximum cardinality</a>.</li>
        </ol>
    		  <pre class="schema turtle"><span class="comment"># shapes (Turtle)</span>
<span class="function-name">my:UserShape</span> <span class="keyword">a</span> <span class="type">sh:</span><span class="constant">Shape</span> ;
    <span class="type">sh:</span><span class="constant">choice</span> [
        <span class="type">sh:</span><span class="constant">property</span> [
            <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">foaf:</span><span class="constant">name</span> ;
            <span class="type">sh:</span><span class="constant">valueType</span> <span class="type">xsd:</span><span class="constant">string</span> ;
            <span class="type">sh:</span><span class="constant">minCount</span> 1 ; <span class="type">sh:</span><span class="constant">maxCount</span> 1
        ] ;
    
        <span class="type">sh:</span><span class="constant">property</span> [
            <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">foaf:</span><span class="constant">givenName</span> ;
            <span class="type">sh:</span><span class="constant">valueType</span> <span class="type">xsd:</span><span class="constant">string</span> ;
            <span class="type">sh:</span><span class="constant">minCount</span> 1
        ] ;
    ] ;                                          
    <span class="type">sh:</span><span class="constant">property</span> [
        <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">foaf:</span><span class="constant">mbox</span> ;
        <span class="type">sh:</span><span class="constant">nodeType</span> <span class="type">sh:</span><span class="constant">IRI</span> ;
        <span class="type">sh:</span><span class="constant">minCount</span> 1
    ] <span class="keyword">.</span></pre>
  </section>

    </section>

    <section id="associations">
    	<h2>Associating Data with Shapes</h2>
      <p>
        SHACL defines two predicates, <span class="type">sh:</span><span class="constant">nodeShape</span> and <span class="type">sh:</span><span class="constant">classShape</span>.
        The former asserts that a particular node in some graph conforms to a specific shape.
        The latter asserts that every node of some type conforms to a specific shape.
        It is expected that different communities will develop many more associations, much as the WSDL community created an association between input and output documents and an XML schema which described them.
      </p>

      <div class="issue">
        <p>
          The <span class="type">sh:</span><span class="constant">classShape</span> predicate describes a way to associate shapes with classes.
          It is currently unclear what is implied by attaching shape properties (e.g. <span class="type">sh:</span><span class="constant">property</span>) directly to a class e.g.:
        </p>
        <pre><span class="type">clinic1234:</span><span class="constant">CompletePatientRecord</span> <span class="keyword">a</span> <span class="type">owl:</span><span class="constant">Class</span> ;
        <span class="type">sh:</span><span class="constant">property</span> [
        <span class="type">sh:</span><span class="constant">predicate</span> <span class="type">clinic1234:</span><span class="constant">phone</span> ;
        <span class="type">sh:</span><span class="constant">valueType</span> <span class="type">xsd:</span><span class="constant">string</span> ;
        <span class="type">sh:</span><span class="constant">minCount</span> 1 ; <span class="type">sh:</span><span class="constant">maxCount</span> 1
        ] <span class="keyword">.</span></pre>

      </div>

      <div class="issue">
        <p>
          It's unclear whether an structure associating nodes returned from a SPARQL query would constitued a <a href="http://www.w3.org/2014/data-shapes/wiki/Requirements#Global_Constraints">global constraint</a>, e.g.
        </p>
        <pre>[ <span class="type">sd:</span><span class="constant">endpoint</span> <span class="function-name">&lt;http://www.example/sparql/&gt;</span> ;
  <span class="type">sd:</span><span class="constant">defaultDataset</span> [
    <span class="type">sd:</span><span class="constant">defaultGraph</span> [
      <span class="type">sd:</span><span class="constant">Graph</span> [
        <span class="type">sh:</span><span class="constant">hasShape</span> <span class="type">ex:</span><span class="constant">IssueShape</span>
      ] ] ] ] <span class="keyword">.</span></pre>
      </div>
    </section>

    <section id="matching">
      <h2>Matching</h2>
      <p>
        This section defines the semantics of <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shapes</a> as a test to see if a <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> in an RDF graph fulfills the shapes constraints.
        Section 6 <a href="assoc">Associating Nodes with Shapes</a> defines facilities for associating a <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> with a <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a>.
      </p>
      <div class="defn">
        <dfn id="dfn-shacl-triple-constraint-matches">triple constraint matches</dfn>
        <p>
          Evaluating a <a title="SHACL constraint" href="#dfn-shacl-triple-constraint" class="internalDFN">triple constraint</a> against a <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> produces a boolean value.
          Evaluation of each form of constraint is defined in <a href="#eval-triple-constraints">6.1 Triple Constraint Evaluation</a>.
        </p>
      </div>
      <div class="defn">
        <dfn id="dfn-shacl-shape-matches">shape matches</dfn>
        <p>
          If the <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a> has no <a title="constraint" href="#dfn-shacl-triple-constraint" class="internalDFN">triple constraint</a>, the result is true.
          Otherwise, evaluation produces the result is the result of evaluating <a title="triple constraint matches" href="#dfn-shacl-triple-constraint-matches">triple constraint matches</a> on the <a title="constraint" href="#dfn-shacl-triple-constraint" class="internalDFN">triple constraint</a> with the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a>.
        </p>
        <!-- p>
          The set of failing triples for a shape is the set of failing triples for each constraint minus the passing triples for each constraint.
          A <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> <dfn id="dfn-shacl-matches">matches</dfn> a <a title="SHACL shape" href="#dfn-shacl-shape" class="internalDFN">shape</a> if there are no remaining failing triples.
          The result is a boolean value.
        </p -->
      </div>
      <section id="eval-triple-constraints">
        <h3>Triple Constraint Evaluation</h3>

        <div class="defn">
          <dfn id="dfn-shacl-property-constraint-matches">property constraint matches</dfn>
          <p>
            The <dfn id="dfn-shacl-matching-triples">matching triples</dfn> is the set of triples in the graph with the subject node of the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> and a predicate of the <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint's</a> predicate.
            Evaluation of a property constraint is an operation across each triple in the graph produces true if each of the following is true:
          </p>
          <ul>
            <li>If the property constraint has a <a title="SHACL minimum cardinality" href="#dfn-shacl-min-card" class="internalDFN">minimum cardinality</a> greather than 0, the <a title="SHACL matching triples" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a> number at least that minimum cardinality.</li>
            <li>If the property constraint has a <a title="SHACL maximum cardinality" href="#dfn-shacl-max-card" class="internalDFN">maximum cardinality</a> greather than 0, the <a title="SHACL matching triples" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a> number no more than that maximum cardinality.</li>
            <li>If there is a <a title="SHACL term constraint" href="#dfn-shacl-term-constraint" class="internalDFN">term constraint</a> present, it matches (see <a href="">6.2 term matches</a>)</li>
          </ul>
        </div>

        <div class="defn">
          <dfn id="dfn-shacl-inverse-property-constraint-matches">inverse property constraint matches</dfn>
          <p>
            The <a title="shacl matching triples" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a> is the set of triples in the graph with the subject node of the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> and a predicate of the <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraint's</a> predicate.
          </p>
        </div>

        <div class="defn">
          <dfn id="dfn-shacl-and-constraint-matches">and constraint matches</dfn>
          <p>
            Evaluation of an <a title="and constraint" href="#dfn-shacl-and-constraint" class="internalDFN">and constraint</a> produces true if evaluation of each of the <a title="SHACL conjunct" href="#dfn-shacl-conjunct" class="internalDFN">conjuncts</a> with the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> produces true.
          </p>
        </div>

        <div class="defn">
          <dfn id="dfn-shacl-or-constraint-matches">or constraint matches</dfn>
          <p>
            Evaluation of an <a title="or constraint" href="#dfn-shacl-or-constraint" class="internalDFN">or constraint</a> produces true if evaluation of any of the constituent constraints with the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> produces true.
          </p>
        </div>
      </section>

      <section id="eval-term-constraints">
        <h3>Term Constraint Evaluation</h3>

        <p>
          <a title="SHACL term constraint" href="#dfn-shacl-term-constraint" class="internalDFN">Term constraints</a> are tested against the objects of <a title="SHACL matching triples" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a> in <a title="SHACL property constraint" href="#dfn-shacl-property-constraint" class="internalDFN">property constraints</a> and the subjects of <a title="SHACL matching triples" href="#dfn-shacl-matching-triples" class="internalDFN">matching triples</a> in <a title="SHACL property constraint" href="#dfn-shacl-inverse-property-constraint" class="internalDFN">inverse property constraints</a>.
        </p>

        <div class="defn">
          <dfn id="dfn-node-type-matches">node type matches</dfn>
          <p>
            Evaluation of a <a title="SHACL node type" href="#dfn-shacl-node-type" class="internalDFN">node type</a> produces true if the evaluated term is of the same RDF Node type (<a title="RDF IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-iri" class="externalDFN">IRI</a>, <a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">RDF literal</a>, or <a title="RDF Blank Node" href="http://www.w3.org/TR/rdf11-concepts/#dfn-blank-node" class="externalDFN">Blank Node</a>).
          </p>
        </div>

				<div class="defn">
          <dfn id="dfn-shacl-datatype-matches">datatype matches</dfn>
          <p>
            Evaluation of a <a title="SHACL datatype" href="#dfn-shacl-datatype" class="internalDFN">datatype</a> produces true if the evaluated term is an <a title="RDF Literal" href="http://www.w3.org/TR/rdf11-concepts/#dfn-literal" class="externalDFN">RDF literal</a> with the same <a title="datatype IRI" href="http://www.w3.org/TR/rdf11-concepts/#dfn-datatype-iri" class="externalDFN">datatype IRI</a>.
          </p>
        </div>

				<div class="defn">
          <dfn id="dfn-shacl-value-set-matches">value set matches</dfn>
          <p>
            Evaluation of a <a title="SHACL value set" href="#dfn-shacl-value-set" class="internalDFN">value set</a> produces true if the evaluated term is a member of the set of <a title="shacl allowed values" href="#dfn-shacl-allowed-value" class="internalDFN">allowed values</a>.
          </p>
        </div>

				<div class="defn">
          <dfn id="dfn-shacl-value-shape-matches">value shape matches</dfn>
          <p>
            Evaluation of a <a title="SHACL value shape" href="#dfn-shacl-value-shape" class="internalDFN">value shape</a> is the result of evaluating <a title="SHACL shape matches" href="#dfn-shacl-shape-matches" class="internalDFN">shape matches</a> where the <a title="SHACL focus node" href="#dfn-shacl-focus-node" class="internalDFN">focus node</a> is the evaluated term.
          </p>
        </div>

      </section>
    </section>

    <!-- section>
      <h2>notes</h2>
      <p>
Adding examples...<br/>
<br/>
<b># empty</b><br/>
<br/>
empty: no constraint.<br/>
<br/>
Example:<br/>
<br/>
<br/>
Note:If we are using open shapes, it will match any node without constraint.<br/>
<br/>
(Maybe, the following comment can be omitted:<br/>
In case of closed shapes it would match a node without any incoming or outgoing edges.<br/>
)<br/>
<br/>
<br/>
<b># arc</b><br/>
<br/>
arc predicate value cardinality: match an arc in the graph with some cardinality.<br/>
<br/>
Two possibilities: unbounded cardinality and bounded cardinality<br/>
<br/>
## arc with unbounded cardinality<br/>
<br/>
arc predicate value {m, unbounded}: it will match a node that has at least m outgoing arcs and whose objects match with the value.<br/>
<br/>
In the axiomatic semantics, I look for m outgoing arcs that match the predicate and value...and return the remaining triples...I think I should reject if there are remaining triples that match the predicate but have values that don't match...
      </p>

<div class="issue">
<h3>Issue (RemainingTriples)</h3>
<p>
It is not clear what is the best semantics when there are remaining triples with the same predicate that don't match the object. Eric's proposal is to fail in that case. Which would mean that the semantics needs to consider that there are no remaining triples with the same predicate and a value that doesn't match. Current axiomatic semantics doesn't fail in that case as it considers those triples "remaining" triples...it would fail if we are using closed shapes.
</p>
<h4>Example:</h4>
<pre>
     schema   -&gt; &lt;shape&gt; { :shoeSize &lt;xsd:integer {1,1} }
     data  -&gt;       &lt;x&gt; :shoeSize "hi" . (should fail because the value doesn't match xsd:integer...
</pre>
<p>
[[<b>Eric</b>...Could you exlain here what you said about missing/failure in natural language...I know you said me in the Skype, but I would like to read it to have a more clear understanding on how you do it...so I could model that with the axiomatic semantics...]
</p>
</div>

<h3>arc with bounded cardinality</h3>
<p>
arc predicate value {m,n}: it will match a node that has between m and n outgoing arcs and whose objects match with the value.
</p>

<div class="issue">
<h3>Issue (remaining triples)</h3>
<p>
It has to review that there are no remaining triples that contain the predicate...
</p>
</div>

<h3>inverse arcs</h3>
<p>
There are also two possibilities: bounded and unbounded cardinality.
The semantics is mostly the same as "arc" but it matches the subjects instead ot the objects.
</p>
<h4>inverse arc with unbounded cardinality</h4>

<p>
inverseArc predicate value {m,unbounded}<br/>
<br/>
## inverse arc with bounded cardinality<br/>
<br/>
inverseArc predicate value {m,unbounded}<br/>
<br/>
# And, conjunction (or interleave)<br/>
<br/>
and(E1,...En): it matches if there are triples that match with E1 and there are triples that match with E2.
</p>

<div class="note">
<h4>Note</h4>
<p>
With this semantics, the same triple can be used to match parts of E1 and of E2.
</p>
<h4>Example:</h4>
<pre>
    schema: &lt;x&gt; { :a xsd:integer, :a . }
    data: &lt;x&gt; :a 1
</pre>
<p>
This example may look non-intuitive because it looks as if it would mean that the shape has two arcs, one with an integer and another with any value, but if there is a single arc with an integer which passes both conjunctions, it also pass.
</p>
</div>

<div class="issue">
<h3>Issue (Multioccurrence)</h3>
<p>
There is an issue when the same predicate occurs in the conjunction. For example:
</p>

<pre>
schema: &lt;x&gt; { :bioParent { :gender ("F") } {1,1} , :bioParent { :gender ("M") }&nbsp; {1,1} }
data: &lt;x&gt; :bioParent [ :gender "F" ] ; :bioParent [ :gender "M" ] .&nbsp; =&gt; Fail
data: &lt;x&gt; :bioParent [ :gender "F" ] ; :bioParent [ :gender "M" ] ; :bioParent [ :gender "Q" ] . =&gt; Fail
data: &lt;x&gt; :bioParent [ :gender "F" ] ; :bioParent [ :gender "M" ] ; :xxx [ :gender "Q" ] . =&gt; Fail should pass because open shapes...extra triples
</pre>

<p>
This issue depends on the "RemainingTriples" issue and the solution to that issue would solve this one.
</p>
</div>

<h3>Or, disjunction</h3>

<p>
or(E1...En): matches if the triples match any of E1...En shapes.<br/>
</p>

<h2>Extended features change that to "Issues"</h2>

<h3>Not</h3>
<p>
not(Shape): Matches if the triples don't match the Shape.
</p>

<div class="issue">
<h3>Issue (NegationShapes)</h3>
<p>
Negation of whole shapes can be difficult to handle when it is combined with recursive shapes.
</p>
<p class="todo">
Explain better and give some example...
</p>
<p>
We may define a simpler definition of negation which only negates arcs and not whole shapes.
</p>
</div>

<h3>noArc(Predicate,Value)</h3>
<p>
matches if there are no outgoing arc with that predicate and an object that matches that Value
</p>

<h3>noInverseArc(Predicate,Value)</h3>
<p>
matches if there are no incoming arc with that predicate and a subject that matches that value.
</p>

<h3>oneOf</h3>
<p>
oneOf(E1,E2) - matches if the triples match with E1 or they match with E2 but not with both.
</p>

<div class="issue">
<h3>Issue (Exclusive-or)</h3>
<p>
Exclusive Or seems to be more intuitive from use cases...for example, "a person has either full name or first name and given name, but not both. The main problem is that it needs negation.
</p>
</div>
<h3>Closed Shapes</h3>

<p>
close(E): matches if the triples match with node E and there are no remaining triples.
</p>

<h3>Issue</h3>
<p>
Maybe include also the notion of closed Schema
</p>
<h3>Cardinality on groups</h3>
<p>
group(E,cardinality): matches if the triples match with Shape E the number of times expressed by the cardinality
</p>

<h3>Extensibility mechanism</h3>

<p>
Extension(Language Code): matches if there is an external processor for language "Language" that process "Code" and returns true.
</p>

    </section -->

  </body>
</html>

