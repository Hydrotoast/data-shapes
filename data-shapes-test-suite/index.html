<html>
  <head>
    <title>SHACL Test Suite</title>
    <meta charset='utf-8'>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" async class="remove"></script>

    <script class='remove'>
      var respecConfig = {
	  //    additionalCopytirhgHolders="",
          specStatus: "unofficial",
          shortName:  "SHACLTestSuite",
          editors: [
           		{   name:       "Jose Emilio Labra Gayo",
                    url:        "http://www.di.uniovi.es/~labra",
                    company:    "WESO Research Group",
                    companyURL: "http://www.weso.es/" },
				{
					name:       "Holger Knublauch",
					url:        "http://knublauch.com/",
					company:    "TopQuadrant, Inc.",
					companyURL: "http://topquadrant.com/",
					w3cid:      46500
				},
                {   name:       "Dimitris Kontokostas",
                    url:        "http://aksw.org/DimitrisKontokostas.html",
                    company:    "University of Leipzig",
                    companyURL: "http://aksw.org/" },
          ],
          wg:           "RDF Data Shapes Working Group",
          wgURI:        "https://www.w3.org/2014/data-shapes/wiki/Main_Page",
          wgPublicList: "public-data-shapes",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/424242/status"
      };
    </script>
	<link rel="stylesheet" href="stylesheets/codemirror.css">
    <script src="javascripts/codemirror.js"></script>
</head>
<body>
	<section id='abstract'>
		<p>
			This document defines the format of the tests in the SHACL test suite,
			and the process to use them to evaluate SHACL implementations.
		</p>
	</section>

    <section id='sotd'>
    </section>
    
    <section class='informative'>
      <h2>Introduction</h2>
      
  	<p>The tests are available 
		in the folder <a href="https://github.com/w3c/data-shapes/tree/gh-pages/data-shapes-test-suite/tests">tests</a>.

    <p>The contents are divided in several folders. </p>
    <p>Each folder contains one or more manifest files that describe the
       tests in that folder.</p> 
       
    <p>The folder <a href="https://github.com/w3c/data-shapes/tree/gh-pages/data-shapes-test-suite/contrib">contrib</a> is available for possible contributions. </p>
 
</section>      
<section>
<h2>Namespace prefixes</h2>

In this document we will employ the following namespace prefixes:

<dl>
<dt><code>sh</code></dt>
<dd><code><a href="http://www.w3.org/ns/shacl#">http://www.w3.org/ns/shacl#</a></code></dd>

<dt><code>sht</code></dt>
<dd><code><a href="http://www.w3.org/ns/shacl/test#">http://www.w3.org/ns/shacl/test#</a></code></dd>

<dt><code>mf</code></dt>
<dd><code><a href="http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#">http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#</a></code></dd>
</dl>

</section>

<section>
<h2>Manifest format</h2>
<p>The manifest file is defined in RDF and is 
   compatible with the manifest used by other W3c initiatives like 
         <a href="www.w3.org/2011/rdf-wg/wiki/RDF_Test_Suites">RDF 1.1</a> or
         <a href="http://www.w3.org/2001/sw/DataAccess/tests/r2">SPARQL</a></p>
         
<pre data-lang="text/turtle">
&lt;&gt; a mf:Manifest ;
     rdfs:label "...Manifest label"
     rdfs:comment "...Manifest comment" ;
     dc:creator "...creator..."
     mf:entries
     (
     ....list of ManifestEntries
     ) .
</pre>
<p>Each manifest entry is a single test which can be one of the following types:</p>
	<ul>
	<li><a href="#Validate">Validate RDF data</a>
	</ul>
</section>

	<section>
		<h2 id="Validate">Validate RDF data</h2>
		<p>
			These tests verify that the validation of a given data graph against a given shapes graph produces
			a specified validation report.
			Both the data graph and the shapes graph may be identical.
		</p>
		<p>
			Example:
		</p>
<pre data-lang="text/turtle">
&lt;entry1&gt; a sht:Validate ;
   mf:name "Validate simple RDF data with a simple shapes graph" ;
   mf:action [
        sht:shapesGraph &lt;example-shapes.ttl&gt; ; 
        sht:dataGraph &lt;example-data.ttl&gt; ; 
   ] ;
   mf:result [
        a sh:ValidationReport ;
        sh:conforms true ;
   ] ;
   mf:status sht:proposed .
</pre>
		<p>
			To pass the test, the validation engine must validate the data graph specified by <code>sht:dataGraph</code>
			against the shapes graph specified by <code>sht:shapesGraph</code>.
			The values of both must be relative URLs pointing at a Turtle file in the same directory as the test file itself.
			It is also valid that either of these graphs point at the manifest graph itself, using the relative URL <code>&lt;&gt;</code>.
		</p>
		<p>
			Let <code>R</code> be the blank node that is the value of <code>mf:result</code> of the <code>sht:Validate</code> test case
			in the manifest graph.
			Let <code>expected</code> be the graph that consists of all triples from the manifest graph that have <code>R</code> as subject
			plus all triples that have all values of <code>sh:result</code> of <code>R</code> as their subject,
			as well as any triples needed to correctly represent the <code>sh:resultPath</code>.
		</p>
		<p>
			Let <code>actual</code> be the results graph produced by the validation, i.e. the validation report.
			Before comparing these results with the <code>expected</code> results, the <code>actual</code> validation report
			must not include any "nested" results, via <code>sh:details</code>.
			The <code>actual</code> results also must not depend on subclass relationships, so that instances of subclasses of 
			<code>sh:ValidationReport</code> and <code>sh:ValidationResult</code> must have these as their (only) <code>rdf:type</code> values.
			Also, all instances of <code>sh:ValidationResult</code> and <code>sh:ValidationReport</code> must be blank nodes,
			i.e. if the engine produces URIs then these need to be replaced with blank nodes.
			Furthermore, only the following predicates are used by triples in the <code>expected</code> graph and therefore
			any other triples (such as <code>sh:sourceConstraint</code>, <code>sh:resultMessage</code> and <code>sh:sourceShape</code>)
			need to be removed from the <code>actual</code> graph prior to comparison:
		</p>
		<ul>
			<li><code>rdf:type sh:ValidationResult</code></li>
			<li><code>sh:focusNode</code></li>
			<li><code>sh:resultPath</code></li>
			<li><code>sh:resultSeverity</code></li>
			<li><code>sh:sourceConstraintComponent</code></li>
			<li><code>sh:value</code></li>
		</ul>
		<p>
			To pass the test, the <code>actual</code> validation report must be <a href="https://www.w3.org/TR/rdf11-concepts/#graph-isomorphism">isomorphic</a> to <code>expected</code>.
		</p>
		<p style="red">TODO: What to do with sh:sourceShape triples or bnode comparison in general?</p>
	</section>
	
	<section>
		<h2>Test Creation, Approval and Modification Process</h2>
		<p>
			Tests are maintained by members of the Working Group in the
			<a href="https://github.com/w3c/data-shapes/tree/gh-pages/data-shapes-test-suite/tests">GitHub</a> repository.
			Anyone, including non-members, can submit or suggest test cases via GitHub pull requests.
			Submissions by other means may be rejected without response.
			Test cases that have not been accepted by the Working Group yet must have <code>mf:status sht:proposed</code>.
		</p>
		<p>
			At the chair's discretion, individual tests or groups of tests are put to the Working Group,
			e.g. in the weekly telecon.
			The Working Group has complete discretion to approve or reject tests.
			Approved tests must have <code>mf:status sht:approved</code>, those that have been rejected
			may get marked as <code>mf:status sht:rejected</code> or deleted from the main branch of the repository.
			All approved tests must be reachable from the root manifest.mf file.
		</p>
		<p>
			Editors may modify test cases, but SHOULD go through the WG process for non-trivial changes.
		</p>
	</section>

	<section>
		<h2>Related information</h2>
		<p>
			The following list contains a list of other test-suites:
		</p>
		<ul>
			<li><a href="http://www.w3.org/2011/rdf-wg/wiki/RDF_Test_Suites">RDF test suite</a></li>
			<li><a href="http://www.w3.org/2001/sw/DataAccess/tests/r2">Data Access Test Suite</a>
			<li><a href="http://www.w3.org/XML/2004/xml-schema-test-suite/">XML Schema test suite</a>
			<li><a href="http://www.gnosis.cx/download/relax/clark.html">RelaxNG test suite</a>
		</ul>
	</section>

</body>

</html>